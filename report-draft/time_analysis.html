<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hello Bulma!</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  <script src="utils.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/roughjs@3.1.0/dist/rough.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-rough@0.2.0"></script>

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="dashboard.html">
        <i class="fas fa-bug"></i>
        Simple test report
      </a>

      <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
        data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">

        <a class="navbar-item" href="dashboard.html">
          <i class="fas fa-tachometer-alt"></i>
          Overview
        </a>

        <a class="navbar-item" href="test-report-content.html">
          smoke_test </a>

        <a class="navbar-item">
          unit_test
        </a>
        <a class="navbar-item">
          integration_test
        </a>
        <a class="navbar-item">
          acceptance_test
        </a>
        <a class="navbar-item">
          interface_test
        </a>
        <a class="navbar-item">
          regression_test
        </a>
        <a class="navbar-item">
          sanity_test
        </a>

        <a class="navbar-item"> Documentation </a>


        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
            More
          </a>


          <div class="navbar-dropdown">
            <a class="navbar-item" href="chartjs_test.html"> chartjs test </a>
            <a class="navbar-item" href="roadmap.html"> Roadmap </a>
            <a class="navbar-item" href="about.html"> About </a>
          </div>

        </div>

        <div class="navbar-item">
          <div class="select">
            <select>
              <option>Select version</option>
              <option>options version 1</option>
              <option>options version 2</option>
              <option>options version 3</option>
              <option>options version 4</option>
              <option>options version 5</option>
              <option>options version 6</option>
              <option>options version 7</option>
              <option>options version 8</option>
            </select>
          </div>
        </div>

      </div>

      <div class="navbar-end">
        <div class="navbar-item">
          <div class="buttons">
            <a class="button is-white" href="https://www.github.com/louiscklaw" target="_blank">
              <i class="fab fa-github-square fa-2x"></i>
              <p style="margin: 0 0.3rem">Github source</p>
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- section -->
  <section class="section" style="padding-top: 1rem; padding-bottom: 1rem;">
    <div class="container">
      <p class="title is-4"> Time spent overview </p>
    </div>
  </section>
  <!-- section -->

  <!-- section  -->
  <section class="section" style="padding-top: 0.5rem">
    <div class="container">

      <!-- columns -->
      <div class="columns is-desktop">

        <!-- column -->
        <div class="column">

          <!-- card -->
          <div class="card">
            <div class="card-image">
              <figure class="is-4by3" style="text-align:center;">
                <div id="canvas-holder" style="width: 90%; margin: auto;">
                  <canvas id="chart-area-time_spent"></canvas>
                </div>
              </figure>
            </div>
            <div class="card-content">
              <div class="media">
                <div class="media-content">
                  <p class="title is-4">total time spent analysis on ver 2</p>
                </div>
              </div>

              <div class="content">
                <p> illustrate the total time spent
                </p>
                <table>
                  <thead>
                    <tr>
                      <td>test name</td>
                      <td>time used (min)</td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>unit_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>integration_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>acceptance_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>interface_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>regression_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>sanity_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>smoke_test</td>
                      <td>2</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- card -->

        </div>
        <!-- column -->

        <!-- column -->
        <div class="column">

          <!-- card -->
          <div class="card">
            <div class="card-image">
              <figure class="is-4by3" style="text-align:center;">
                <div id="canvas-holder" style="width: 90%; margin: auto;">
                  <canvas id="canvas-total-time-spent"></canvas>
                </div>
              </figure>
            </div>
            <div class="card-content">
              <div class="media">
                <div class="media-content">
                  <p class="title is-4">total time spent analysis on ver 2</p>
                </div>
              </div>

              <div class="content">
                <p> illustrate the total time spent
                </p>
                <table>
                  <thead>
                    <tr>
                      <td>test name</td>
                      <td>time used (min)</td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>unit_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>integration_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>acceptance_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>interface_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>regression_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>sanity_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>smoke_test</td>
                      <td>2</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- card -->

        </div>
        <!-- column -->

        <!-- column -->
        <div class="column">

          <!-- card -->
          <div class="card">
            <div class="card-image">
              <figure class="is-4by3" style="text-align:center;">
                <div id="canvas-holder" style="width: 90%; margin: auto;">
                  <canvas id="canvas-test-case-growth"></canvas>
                </div>
              </figure>
            </div>
            <div class="card-content">
              <div class="media">
                <div class="media-content">
                  <p class="title is-4">test case growth history</p>
                </div>
              </div>

              <div class="content">
                <p> illustrate the total time spent
                </p>
                <table>
                  <thead>
                    <tr>
                      <td>test name</td>
                      <td>time used (min)</td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>unit_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>integration_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>acceptance_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>interface_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>regression_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>sanity_test</td>
                      <td>2</td>
                    </tr>
                    <tr>
                      <td>smoke_test</td>
                      <td>2</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- card -->

        </div>
        <!-- column -->

      </div>
      <!-- columns -->




    </div>
  </section>
  <!-- section  -->




  <script>
    const color = Chart.helpers.color;
    const basic_color_config = {
      'unit_test': color( window.chartColors.red ).rgbString(),
      'integration_test': color( window.chartColors.yellow ).rgbString(),
      'acceptance_test': color( window.chartColors.blue ).rgbString(),
      'interface_test': color( window.chartColors.green ).rgbString(),
      'regression_test': color( window.chartColors.orange ).rgbString(),
      'sanity_test': color( window.chartColors.pink ).rgbString(),
      'smoke_test': color( window.chartColors.purple ).rgbString()
    }
    const color_config = {
      'unit_test': color( window.chartColors.red ).alpha( 0.5 ).rgbString(),
      'integration_test': color( window.chartColors.yellow ).alpha( 0.5 ).rgbString(),
      'acceptance_test': color( window.chartColors.blue ).alpha( 0.5 ).rgbString(),
      'interface_test': color( window.chartColors.green ).alpha( 0.5 ).rgbString(),
      'regression_test': color( window.chartColors.orange ).alpha( 0.5 ).rgbString(),
      'sanity_test': color( window.chartColors.pink ).alpha( 0.5 ).rgbString(),
      'smoke_test': color( window.chartColors.purple ).alpha( 0.5 ).rgbString()
    }

    var randomScalingFactor = function () {
      return Math.round( Math.random() * 100 );
    };

    var chart_config = {
      type: 'doughnut',
      options: {
        aspectRatio: 1,
        responsive: true,
        legend: {
          position: 'right',
        },
        animation: {
          animateScale: true,
          animateRotate: true
        }
      }
    };


    function get_time_spent_by_test( json_in ) {
      return Object.keys( json_in ).map( test_name => parseInt( json_in[ test_name ].run_time ) )
    }

    function get_time_spent_data( json_in ) {
      return {
        ...chart_config,
        options: {
          ...chart_config.options,
          aspectRatio: 1,
          title: {
            display: true,
            text: 'test_name result'
          },
          legend: {
            position: 'right'
          }
        },
        // plugins: [ ChartRough ],
        data: {
          datasets: [ {
            data: [
              1,
              2,
              3,
              4,
              5,
              6,
              7
            ],
            backgroundColor: [
              'unit_test',
              'integration_test',
              'acceptance_test',
              'interface_test',
              'regression_test',
              'sanity_test',
              'smoke_test'
            ].map( test_name => basic_color_config[ test_name ] ),
            borderColor: [
              'unit_test',
              'integration_test',
              'acceptance_test',
              'interface_test',
              'regression_test',
              'sanity_test',
              'smoke_test'
            ].map( test_name => color_config[ test_name ] ),

            label: 'Dataset 1'
          } ],
          labels: [
            'unit',
            'integration',
            'acceptance',
            'interface',
            'regression',
            'sanity',
            'smoke'
          ]
        }
      }
    }

    function plot_time_spent( x ) {
      var ele = document.querySelector( '#chart-area-time_spent' )
      var time_spent_by_test = get_time_spent_by_test( x )
      var time_spent_total = time_spent_by_test.reduce( ( x, y ) => x + y )

      var ctx = document.getElementById( 'chart-area-time_spent' ).getContext( '2d' );
      window.myDoughnut = new Chart( ctx, get_time_spent_data() );
    }


    fetch( 'data.json' )
      .then( resp => resp.json() )
      .then( ( x ) => {

        // plot_chart( x )
        plot_time_spent( x )

      } )

    function plot_time_spent_historical( json_in ) {
      test_history = json_in


      const versions_in_history = test_history.map( history_item => history_item.version )

      // expecting ver2
      const latest_test_version = versions_in_history[ 0 ]
      const latest_test_version_info = test_history[ 0 ].info

      const test_names = Object.keys( latest_test_version_info )
      const length_of_history = test_history.length

      const get_time_spent_by_test_name = ( test_name ) => {

        const time_spent_by_test_history = test_history.map( past_test => past_test.info[ test_name ].time_spent )
        return time_spent_by_test_history
      }


      var horizontalBarChartData = {
        labels: versions_in_history,
        datasets: test_names.map( test_name => {
          return {
            label: test_name,
            backgroundColor: color_config[ test_name ],
            borderColor: basic_color_config[ test_name ],
            borderWidth: 1,
            data: get_time_spent_by_test_name( test_name )
          }
        } )
      };


      var ctx = document.getElementById( 'canvas-total-time-spent' ).getContext( '2d' );
      window.myHorizontalBar = new Chart( ctx, {
        type: 'horizontalBar',
        data: horizontalBarChartData,
        // plugins: [ ChartRough ],
        options: {
          aspectRatio: 1,
          scales: {
            xAxes: [ {
              stacked: true
            } ],
            yAxes: [ {
              stacked: true
            } ]
          },
          elements: {
            rectangle: {
              borderWidth: 2,
            }
          },
          responsive: true,
          legend: {
            position: 'right',
          },
          title: {
            display: true,
            text: 'Time spent historical'
          }
        }
      } );

    }

    function plot_test_case_growth( json_in ) {
      const test_history = json_in.reverse()

      const versions_in_history = test_history.map( history_item => history_item.version )

      const versions_from_old_to_new = test_history.map( history_item => history_item.version )

      // expecting ver2
      const latest_test_version = versions_in_history[ 0 ]
      const latest_test_version_info = test_history[ 0 ].info

      const test_names = Object.keys( latest_test_version_info )
      const length_of_history = test_history.length

      const get_time_spent_by_test_name = ( test_name ) => {

        const time_spent_by_test_history = test_history.map( past_test => past_test.info[ test_name ].time_spent )
        return time_spent_by_test_history
      }


      var horizontalBarChartData = {
        labels: versions_from_old_to_new,
        datasets: test_names.map( test_name => {
          return {
            label: test_name,
            backgroundColor: color_config[ test_name ],
            borderColor: basic_color_config[ test_name ],
            borderWidth: 1,
            data: get_time_spent_by_test_name( test_name )
          }
        } )
      };


      var ctx = document.getElementById( 'canvas-test-case-growth' ).getContext( '2d' );
      window.myHorizontalBar = new Chart( ctx, {
        type: 'bar',
        data: horizontalBarChartData,
        // plugins: [ ChartRough ],
        options: {
          aspectRatio: 1,
          scales: {
            xAxes: [ {
              stacked: true
            } ],
            yAxes: [ {
              stacked: true
            } ]
          },
          elements: {
            rectangle: {
              borderWidth: 2,
            }
          },
          responsive: true,
          legend: {
            position: 'bottom',
          },
          title: {
            display: true,
            text: 'Time spent historical'
          }
        }
      } );

    }


    fetch( 'test_history.json' )
      .then( resp => resp.json() )
      .then( ( fetched_json ) => {
        plot_time_spent_historical( fetched_json )
        plot_test_case_growth( fetched_json )
      } )
  </script>


  <!-- footer -->
  <footer class="footer">
    <div class="content has-text-centered">
      <div class="container">

        <p> Simple test report for xxxxx </p>

        <a class="button is-small is-white" href="//www.github.com/louiscklaw" target="_blank">
          <i class="fab fa-github-square fa-2x"></i>
          <span style="padding-left: 0.5rem;">www.github.com/louiscklaw</span>
        </a>


        <a class="button is-small is-white" href="//www.facebook.com/louiscklaw" target="_blank">
          <i class="fab fa-facebook-square fa-2x"></i>
          <span style="padding-left: 0.5rem;">www.facebook.com/louiscklaw</span>
        </a>


        <a class="button is-small is-white" href="//www.linkedin.com/in/louiscklaw" target="_blank">
          <i class="fab fa-linkedin fa-2x"></i>
          <span style="padding-left: 0.5rem;">www.linkedin.com/in/louiscklaw</span>
        </a>

      </div>
    </div>
  </footer>
  <!-- footer -->


</body>

</html>
